{"version":3,"sources":["webpack:///./src/views/Post.vue","webpack:///./src/views/Post.vue?876e"],"names":["class","_createElementVNode","style","novalidate","for","_createElementBlock","_hoisted_4","_hoisted_8","id","rows","placeholder","$data","content","$event","type","accept","ref","onChange","$options","src","alt","_toDisplayString","disabled","onClick","_hoisted_15","_createVNode","_component_Sidebar","_component_SidebarSm","ws","WebSocket","name","components","Sidebar","SidebarSm","data","info","image","imagePreview","errorMessage","computed","mapGetters","methods","getPreviewFile","this","input","$refs","files","URL","createObjectURL","uploadFile","Promise","resolve","reject","FormData","append","DataTransfer","config","method","url","process","headers","authorization","token","$http","then","res","message","link","status","catch","error","response","uploadPost","submitPost","$store","dispatch","send","JSON","stringify","$router","push","__exports__","render"],"mappings":"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","file":"js/chunk-2d0baaa9.8fae97d9.js","sourcesContent":["<template>\r\n  <section class=\"container mt-7 mb-7 mb-md-0 px-lg-12\">\r\n    <div class=\"row\">\r\n      <div class=\"col-md-7\">\r\n        <div class=\"card mb-5 rounded-0 border-2 position-relative\">\r\n          <h2 class=\"text-center fw-bold py-3 mb-0 fs-5\">張貼動態</h2>\r\n          <div\r\n            class=\"position-absolute border border-dark border-2 w-100 py-4\"\r\n            style=\"z-index: -1; top: 10px; left: -6px\"\r\n          ></div>\r\n        </div>\r\n        <div class=\"card border border-dark border-2 shadow-black p-5\">\r\n          <form class=\"needs-validation\" novalidate>\r\n            <div class=\"form-group mb-3\">\r\n              <label for=\"content\">貼文內容</label>\r\n              <textarea\r\n                class=\"form-control\"\r\n                id=\"content\"\r\n                rows=\"5\"\r\n                placeholder=\"輸入您的貼文內容\"\r\n                v-model=\"info.content\"\r\n              ></textarea>\r\n            </div>\r\n            <div class=\"input-group mb-2\">\r\n              <label class=\"btn btn-dark\">\r\n                <input\r\n                  id=\"upload_img\"\r\n                  style=\"display: none\"\r\n                  type=\"file\"\r\n                  class=\"is-valid\"\r\n                  accept=\"image/png, image/jpeg, image/jpg\"\r\n                  ref=\"upload-file\"\r\n                  @change=\"getPreviewFile\"\r\n                />\r\n                上傳圖片\r\n              </label>\r\n            </div>\r\n            <img\r\n              :src=\"imagePreview\"\r\n              alt=\"photo1\"\r\n              class=\"w-100 img-fluid mb-2\"\r\n              v-show=\"imagePreview\"\r\n            />\r\n            <p\r\n              v-if=\"errorMessage\"\r\n              class=\"text-danger text-center mb-2 fs-7 d-block\"\r\n            >\r\n              {{ errorMessage }}\r\n            </p>\r\n            <div class=\"d-grid gap-2\">\r\n              <button\r\n                type=\"submit\"\r\n                class=\"btn btn-gray-dark border border-dark border-2 fw-bold\"\r\n                :disabled=\"!info.content\"\r\n                @click.prevent=\"submitPost()\"\r\n              >\r\n                送出貼文\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n      <Sidebar></Sidebar>\r\n    </div>\r\n    <SidebarSm></SidebarSm>\r\n  </section>\r\n</template>\r\n\r\n<script>\r\nimport Sidebar from '../components/Sidebar.vue'\r\nimport SidebarSm from '../components/SidebarSm.vue'\r\nimport { mapGetters } from 'vuex'\r\n\r\nconst ws = new WebSocket('wss://secure-plains-31314.herokuapp.com/websockets')\r\n\r\nexport default {\r\n  name: 'post',\r\n  components: {\r\n    Sidebar,\r\n    SidebarSm\r\n  },\r\n  data () {\r\n    return {\r\n      info: {\r\n        content: '',\r\n        image: ''\r\n      },\r\n      imagePreview: '',\r\n      errorMessage: ''\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters(['token'])\r\n  },\r\n  methods: {\r\n    // 預覽圖片\r\n    getPreviewFile () {\r\n      this.errorMessage = ''\r\n      const input = this.$refs['upload-file']\r\n      if (input.files[0]) {\r\n        this.imagePreview = URL.createObjectURL(input.files[0])\r\n      } else {\r\n        this.imagePreview = ''\r\n        this.errorMessage = '請選擇上傳圖片'\r\n      }\r\n    },\r\n    // 上傳 imgur\r\n    uploadFile () {\r\n      return new Promise((resolve, reject) => {\r\n        const input = this.$refs['upload-file']\r\n        const data = new FormData()\r\n        data.append('image', input.files[0])\r\n        // 清空 input，避免重複選同一檔案無法觸發 change 事件\r\n        input.files = new DataTransfer().files\r\n\r\n        const config = {\r\n          method: 'POST',\r\n          url: `${process.env.VUE_APP_APIPATH}/api/v1/file`,\r\n          headers: {\r\n            authorization: `Bearer ${this.token}`\r\n          },\r\n          data: data\r\n        }\r\n        this.$http(config)\r\n          .then((res) => {\r\n            this.info.image = res.data.message.link\r\n            this.imagePreview = ''\r\n            resolve(res.data.status)\r\n          })\r\n          .catch((error) => {\r\n            this.errorMessage = error.response.data.message\r\n            reject(this.errorMessage)\r\n            this.imagePreview = ''\r\n          })\r\n      })\r\n    },\r\n    uploadPost () {\r\n      return new Promise((resolve, reject) => {\r\n        const config = {\r\n          method: 'POST',\r\n          url: `${process.env.VUE_APP_APIPATH}/api/v1/post`,\r\n          headers: {\r\n            authorization: `Bearer ${this.token}`\r\n          },\r\n          data: this.info\r\n        }\r\n        this.$http(config)\r\n          .then((res) => {\r\n            this.info.content = ''\r\n            resolve(res.data.status)\r\n          })\r\n          .catch((error) => {\r\n            this.info.content = ''\r\n            reject(error.data)\r\n          })\r\n      })\r\n    },\r\n    async submitPost () {\r\n      try {\r\n        this.$store.dispatch('updateLoading', true)\r\n        if (this.imagePreview) {\r\n          // 先傳圖片\r\n          await this.uploadFile()\r\n        }\r\n        const response = await this.uploadPost()\r\n        await ws.send(JSON.stringify(response))\r\n        this.$store.dispatch('updateLoading', false)\r\n        this.$router.push({ name: '首頁' })\r\n      } catch (error) {\r\n        if (!this.errorMessage) {\r\n          this.errorMessage = error\r\n        }\r\n        this.$store.dispatch('updateLoading', false)\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n</style>\r\n","import { render } from \"./Post.vue?vue&type=template&id=4e315416\"\nimport script from \"./Post.vue?vue&type=script&lang=js\"\nexport * from \"./Post.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"C:\\\\Users\\\\johnny\\\\Desktop\\\\metawall-front\\\\node_modules\\\\@vue\\\\cli-service\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}