(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0baaa9"],{"37d3":function(e,t,a){"use strict";a.r(t);var r=a("7a23"),n={class:"container mt-7 mb-7 mb-md-0 px-lg-12"},i={class:"row"},s={class:"col-md-7"},o=Object(r["i"])("div",{class:"card mb-5 rounded-0 border-2 position-relative"},[Object(r["i"])("h2",{class:"text-center fw-bold py-3 mb-0 fs-5"},"張貼動態"),Object(r["i"])("div",{class:"position-absolute border border-dark border-2 w-100 py-4",style:{"z-index":"-1",top:"10px",left:"-6px"}})],-1),c={class:"card border border-dark border-2 shadow-black p-5"},d={class:"needs-validation",novalidate:""},l={class:"form-group mb-3"},b=Object(r["i"])("label",{for:"content"},"貼文內容",-1),u={class:"input-group mb-2"},p={class:"btn btn-dark"},m=Object(r["k"])(" 上傳圖片 "),f=["src"],g={key:0,class:"text-danger text-center mb-2 fs-7 d-block"},h={class:"d-grid gap-2"},v=["disabled"];function O(e,t,a,O,j,w){var k=Object(r["H"])("Sidebar"),P=Object(r["H"])("SidebarSm");return Object(r["y"])(),Object(r["h"])("section",n,[Object(r["i"])("div",i,[Object(r["i"])("div",s,[o,Object(r["i"])("div",c,[Object(r["i"])("form",d,[Object(r["i"])("div",l,[b,Object(r["U"])(Object(r["i"])("textarea",{class:"form-control",id:"content",rows:"5",placeholder:"輸入您的貼文內容","onUpdate:modelValue":t[0]||(t[0]=function(e){return j.info.content=e})},null,512),[[r["P"],j.info.content]])]),Object(r["i"])("div",u,[Object(r["i"])("label",p,[Object(r["i"])("input",{id:"upload_img",style:{display:"none"},type:"file",class:"is-valid",accept:"image/png, image/jpeg, image/jpg",ref:"upload-file",onChange:t[1]||(t[1]=function(){return w.getPreviewFile&&w.getPreviewFile.apply(w,arguments)})},null,544),m])]),Object(r["U"])(Object(r["i"])("img",{src:j.imagePreview,alt:"photo1",class:"w-100 img-fluid mb-2"},null,8,f),[[r["Q"],j.imagePreview]]),j.errorMessage?(Object(r["y"])(),Object(r["h"])("p",g,Object(r["K"])(j.errorMessage),1)):Object(r["g"])("",!0),Object(r["i"])("div",h,[Object(r["i"])("button",{type:"submit",class:"btn btn-gray-dark border border-dark border-2 fw-bold",disabled:!j.info.content,onClick:t[2]||(t[2]=Object(r["W"])((function(e){return w.submitPost()}),["prevent"]))}," 送出貼文 ",8,v)])])])]),Object(r["l"])(k)]),Object(r["l"])(P)])}var j=a("1da1"),w=a("5530"),k=(a("96cf"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("9911"),a("e9c4"),a("5ea5")),P=a("7441"),x=a("5502"),y=new WebSocket("wss://secure-plains-31314.herokuapp.com/websockets"),S={name:"post",components:{Sidebar:k["a"],SidebarSm:P["a"]},data:function(){return{info:{content:"",image:""},imagePreview:"",errorMessage:""}},computed:Object(w["a"])({},Object(x["b"])(["token"])),methods:{getPreviewFile:function(){this.errorMessage="";var e=this.$refs["upload-file"];e.files[0]?this.imagePreview=URL.createObjectURL(e.files[0]):(this.imagePreview="",this.errorMessage="請選擇上傳圖片")},uploadFile:function(){var e=this;return new Promise((function(t,a){var r=e.$refs["upload-file"],n=new FormData;n.append("image",r.files[0]),r.files=(new DataTransfer).files;var i={method:"POST",url:"".concat("https://metawall-express-final.onrender.com","/api/v1/file"),headers:{authorization:"Bearer ".concat(e.token)},data:n};e.$http(i).then((function(a){e.info.image=a.data.message.link,e.imagePreview="",t(a.data.status)})).catch((function(t){e.errorMessage=t.response.data.message,a(e.errorMessage),e.imagePreview=""}))}))},uploadPost:function(){var e=this;return new Promise((function(t,a){var r={method:"POST",url:"".concat("https://metawall-express-final.onrender.com","/api/v1/post"),headers:{authorization:"Bearer ".concat(e.token)},data:e.info};e.$http(r).then((function(a){e.info.content="",t(a.data.status)})).catch((function(t){e.info.content="",a(t.data)}))}))},submitPost:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.$store.dispatch("updateLoading",!0),!e.imagePreview){t.next=5;break}return t.next=5,e.uploadFile();case 5:return t.next=7,e.uploadPost();case 7:return a=t.sent,t.next=10,y.send(JSON.stringify(a));case 10:e.$store.dispatch("updateLoading",!1),e.$router.push({name:"首頁"}),t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](0),e.errorMessage||(e.errorMessage=t.t0),e.$store.dispatch("updateLoading",!1);case 18:case"end":return t.stop()}}),t,null,[[0,14]])})))()}}},M=a("d959"),$=a.n(M);const F=$()(S,[["render",O]]);t["default"]=F}}]);
//# sourceMappingURL=chunk-2d0baaa9.8fae97d9.js.map